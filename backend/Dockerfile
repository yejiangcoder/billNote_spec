FROM python:3.11-slim

# =========================
# 1ï¸âƒ£ æ¢æº + å®‰è£…ç³»ç»Ÿçº§ä¾èµ–ï¼ˆFFmpegï¼‰
# =========================
RUN rm -f /etc/apt/sources.list && \
    rm -rf /etc/apt/sources.list.d/* && \
    echo "deb https://mirrors.tuna.tsinghua.edu.cn/debian bookworm main contrib non-free non-free-firmware" > /etc/apt/sources.list && \
    echo "deb https://mirrors.tuna.tsinghua.edu.cn/debian bookworm-updates main contrib non-free non-free-firmware" >> /etc/apt/sources.list && \
    echo "deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware" >> /etc/apt/sources.list && \
    apt-get update && \
    apt-get install -y ffmpeg && \
    rm -rf /var/lib/apt/lists/*

# =========================
# 2ï¸âƒ£ ç¯å¢ƒå˜é‡ï¼ˆğŸ”¥ å…³é”®ï¼‰
# =========================
ENV PATH="/usr/bin:${PATH}"
ENV HF_ENDPOINT=https://hf-mirror.com
ENV TRANSCRIBER_TYPE=bcut


# =========================
# 3ï¸âƒ£ å·¥ä½œç›®å½•
# =========================
WORKDIR /app

# =========================
# 4ï¸âƒ£ å…ˆæ‹·è´ä¾èµ–æ¸…å•ï¼ˆåˆ©ç”¨ Docker ç¼“å­˜ï¼‰
# ï¼ˆä½ ç°åœ¨ docker build å°±æ˜¯åœ¨ backend ç›®å½• ğŸ‘ï¼‰
# =========================
COPY requirements.txt /app/requirements.txt

RUN pip install --no-cache-dir \
    -i https://pypi.tuna.tsinghua.edu.cn/simple \
    -r requirements.txt

# =========================
# 5ï¸âƒ£ å†æ‹·è´å…¨éƒ¨æºä»£ç 
# =========================
COPY . /app

# =========================
# 6ï¸âƒ£ å¯åŠ¨å…¥å£ï¼ˆCLI / Web è‡ªåŠ¨åˆ†æµï¼‰
# =========================
CMD ["python", "main.py"]
